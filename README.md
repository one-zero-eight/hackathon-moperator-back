# FSP Хакатон 2023

# Postgram Admin — Backend

Backend является центральным компонентом системы Postgram Admin. Он предоставляет доступ
к очереди уведомлений, метрикам баз данных, истории инцидентов, выполнению сценариев и представлений.
Также является единственным доверенным узлом для взаимодействия с базами данных.

Может быть связан с многими базами данных(серверами postgres), каждая из которых будет
предоставлять свои метрики и инцидентами. В рамках отдельной базы данных есть свой список админов.

## Содержание

- [Стек](#Стек)
- [Функционал](#Функционал)
    - [Сценарии (actions)](#Сценарии-actions)
    - [Представления (views)](#Представления-views)
    - [Уведомления об инцидентах (alerts)](#Уведомления-об-инцидентах-alerts)

## Стек

- **[Python](https://www.python.org/)** — язык программирования. _Почему? — знакомый инструмент, который предоставляет
  удобный интерфейс для работы с серверными приложениями и базами данных._
- **[FastAPI](https://fastapi.tiangolo.com/)** — фреймворк для разработки серверных приложений. _Почему? — знакомый
  инструмент, который предоставляет удобный интерфейс для развертывания своего REST API с автоматической документацией._
- **[Prometheus](https://prometheus.io/)** — система мониторинга и алертинга. _Почему? — наиболее используемый и удобный
  инструмент для мониторинга и оповещений._
- **[Grafana](https://grafana.com/)** — система визуализации данных. _Почему? — удобный инструмент для визуализации
  метрик Prometheus._
- **[SQLAlchemy](https://www.sqlalchemy.org/)** — ORM для работы с базами данных. _Почему? — _Лидер среди Python
  фреймворков для работы с реляционными SQL базами данных._
- **[PostgreSQL](https://www.postgresql.org/)** — реляционная база данных. _Почему? — весь кейс посвящен именно этой БД,
  поддерживает асинхронность._

## Функционал

### Сценарии (actions)

Сценарий это набор шагов (SQL-запросов, bash-скриптов) и деклараций аргументов, которые
могут быть выполнены в любой момент времени через эндпоинт REST API.

DevOps-инженер может создать сценарий, который будет добавлен в систему, через конфигурационный
файл `actions.yaml`.

Аутентифированный пользователь может выполнить доступные ему сценарии через `/actions/execute/{action_alias}`.

### Представления (views)

Представление это SQL-запрос, которое возвращает результат в виде таблицы.

DevOps-инженер может создать представление, которое будет добавлено в систему, через конфигурационный
файл `views.yaml`.

Пользователь может получить сконфигурированное представление через `/views/{view_alias}`.

### Уведомления об инцидентах (alerts)

- В случае возникновения какого-либо инцидента (или его устранения) система получает от Prometheus
  и записывает информацию об этом в очередь, формирует список получатель уведомлений об этом.
- Telegram-бот получает сообщение из очереди и отправляет его получателям. Подтверждает получение
  сообщения и удаляет его из очереди.
- SMTP сервер получает сообщение из очереди и отправляет его получателям.
- Если с данным типом инцидента связаны какие-либо сценарии или представления, они также будут
- отправлены для быстрого доступа к соответствующему функционалу.
